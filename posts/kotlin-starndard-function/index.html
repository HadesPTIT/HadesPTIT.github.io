<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="[Android] Kotlin standard functions: run-with-let-also-apply" /><meta property="og:locale" content="en_US" /><meta name="description" content="Giới thiệu Standard.kt là một phần nằm trong Kotlin library. Trong đó định nghĩa một số hàm mở rộng như let, apply, run with also mà chắc hẳn bạn đã từng nhìn thấy trong các guide hay đã từng sử dụng chúng." /><meta property="og:description" content="Giới thiệu Standard.kt là một phần nằm trong Kotlin library. Trong đó định nghĩa một số hàm mở rộng như let, apply, run with also mà chắc hẳn bạn đã từng nhìn thấy trong các guide hay đã từng sử dụng chúng." /><link rel="canonical" href="https://hadesptit.github.io/posts/kotlin-starndard-function/" /><meta property="og:url" content="https://hadesptit.github.io/posts/kotlin-starndard-function/" /><meta property="og:site_name" content="Hades" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-01-23T14:15:03+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[Android] Kotlin standard functions: run-with-let-also-apply" /><meta name="twitter:site" content="@hades_pt" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-01-23T14:15:03+00:00","datePublished":"2019-01-23T14:15:03+00:00","description":"Giới thiệu Standard.kt là một phần nằm trong Kotlin library. Trong đó định nghĩa một số hàm mở rộng như let, apply, run with also mà chắc hẳn bạn đã từng nhìn thấy trong các guide hay đã từng sử dụng chúng.","headline":"[Android] Kotlin standard functions: run-with-let-also-apply","mainEntityOfPage":{"@type":"WebPage","@id":"https://hadesptit.github.io/posts/kotlin-starndard-function/"},"url":"https://hadesptit.github.io/posts/kotlin-starndard-function/"}</script><title>[Android] Kotlin standard functions: run-with-let-also-apply | Hades</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/20601191?s=400" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hades</a></div><div class="site-subtitle font-italic">Chase excellence success will follow you</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/HadesPTIT" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/hades_pt" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['Hphamptit','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>[Android] Kotlin standard functions: run-with-let-also-apply</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[Android] Kotlin standard functions: run-with-let-also-apply</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Hades </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jan 23, 2019, 2:15 PM +0000" prep="on" > Jan 23, 2019 <i class="unloaded">2019-01-23T14:15:03+00:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1329 words">7 min</span></div></div><div class="post-content"><h1 id="giới-thiệu">Giới thiệu</h1><p><a href="https://github.com/JetBrains/kotlin/blob/master/libraries/stdlib/src/kotlin/util/Standard.kt">Standard.kt</a> là một phần nằm trong Kotlin library. Trong đó định nghĩa một số hàm mở rộng như <code class="language-plaintext highlighter-rouge">let</code>, <code class="language-plaintext highlighter-rouge">apply</code>, <code class="language-plaintext highlighter-rouge">run</code> <code class="language-plaintext highlighter-rouge">with</code> <code class="language-plaintext highlighter-rouge">also</code> mà chắc hẳn bạn đã từng nhìn thấy trong các guide hay đã từng sử dụng chúng.</p><p>Trong bài biết này, ta sẽ cùng tìm hiểu cách để phân biệt sự khác nhau giữa chúng và khi nào thì sử dụng nhé :D</p><h3 id="scoping-functions">Scoping Functions</h3><p>Một số function mà mình focus vào là <em><code class="language-plaintext highlighter-rouge">run</code>, <code class="language-plaintext highlighter-rouge">with</code>, <code class="language-plaintext highlighter-rouge">T.run</code>, <code class="language-plaintext highlighter-rouge">T.let</code>, <code class="language-plaintext highlighter-rouge">T.also</code> và <code class="language-plaintext highlighter-rouge">T.apply</code></em>. Ta gọi đó là những scoping function (hàm phạm vi) bởi chúng có chức năng chính là cung cấp scope nhỏ hơn từ hàm gọi nó.</p><p>Bên dưới là một ví dụ về scoping function :</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="n">fun</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">mood</span> <span class="o">=</span> <span class="s">"I am sad"</span>

    <span class="n">run</span> <span class="o">{</span>
        <span class="n">val</span> <span class="n">mood</span> <span class="o">=</span> <span class="s">"I am happy"</span>
        <span class="n">println</span><span class="o">(</span><span class="n">mood</span><span class="o">)</span> <span class="c1">// I am happy</span>
    <span class="o">}</span>

    <span class="n">println</span><span class="o">(</span><span class="n">mood</span><span class="o">)</span>  <span class="c1">// I am sad</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Với ví dụ này thì bạn có thể có một scope riêng biệt với giá trị mood được định nghĩa lại thành <code class="language-plaintext highlighter-rouge">I am happy</code> và nó chỉ tồn tại bên trong <code class="language-plaintext highlighter-rouge">run</code>. Một hữu ích khác của <code class="language-plaintext highlighter-rouge">run</code> là nó trả về đối tượng cuối cùng nằm trong scope.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>    <span class="n">run</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">firstTimeView</span><span class="o">)</span> <span class="n">introView</span> <span class="k">else</span> <span class="n">normalView</span>
    <span class="o">}.</span><span class="na">show</span><span class="o">()</span>
    
    <span class="c1">// similarly</span>
    
    <span class="k">if</span> <span class="o">(</span><span class="n">firstTimeView</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">introView</span><span class="o">.</span><span class="na">show</span><span class="o">()</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">normalView</span><span class="o">.</span><span class="na">show</span><span class="o">()</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>Dễ thấy sử dụng <code class="language-plaintext highlighter-rouge">run</code> sẽ ngắn gọn hơn nhiều so với cách thông thường,</p><h3 id="3-attributes-of-scoping-functions">3 attributes of scoping functions</h3><p>Để phân loại các scoping funtion, ta sẽ dựa vào những tiêu chí sau :</p><ul><li>Normal vs. extension function<li>This vs. it argument<li>Return this vs. other type</ul><h4 id="1-normal-vs-extension-function">1. Normal vs. extension function</h4><p>Nếu ta để ý <code class="language-plaintext highlighter-rouge">with</code> và <code class="language-plaintext highlighter-rouge">T.run</code> sẽ thấy 2 hàm này khá là giống nhau. Ví dụ bên dưới cho ra kết quả tương đương nhau :</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="n">with</span><span class="o">(</span><span class="n">webview</span><span class="o">.</span><span class="na">settings</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">javaScriptEnabled</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="n">databaseEnabled</span> <span class="o">=</span> <span class="kc">true</span>
<span class="o">}</span>
<span class="c1">// similarly</span>
<span class="n">webview</span><span class="o">.</span><span class="na">settings</span><span class="o">.</span><span class="na">run</span> <span class="o">{</span>
    <span class="n">javaScriptEnabled</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="n">databaseEnabled</span> <span class="o">=</span> <span class="kc">true</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Tuy nhiên, khác nhau giữa chúng là một thằng là normal function (<code class="language-plaintext highlighter-rouge">with</code>), một thằng là extension function (<code class="language-plaintext highlighter-rouge">T.run</code>) Vậy khi nào thì sử dụng <code class="language-plaintext highlighter-rouge">with</code>, khi nào thì sử dụng <code class="language-plaintext highlighter-rouge">T.run</code> ?</p><p>Hãy tưởng tượng nếu webview.settings có thể <code class="language-plaintext highlighter-rouge">null</code>, ví dụ bên trên sẽ được viết lại như sau :</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">// Yack!</span>
<span class="n">with</span><span class="o">(</span><span class="n">webview</span><span class="o">.</span><span class="na">settings</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">?.</span><span class="na">javaScriptEnabled</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="k">this</span><span class="o">?.</span><span class="na">databaseEnabled</span> <span class="o">=</span> <span class="kc">true</span>
   <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// Nice.</span>
<span class="n">webview</span><span class="o">.</span><span class="na">settings</span><span class="o">?.</span><span class="na">run</span> <span class="o">{</span>
    <span class="n">javaScriptEnabled</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="n">databaseEnabled</span> <span class="o">=</span> <span class="kc">true</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Trong trường hợp này, <code class="language-plaintext highlighter-rouge">T.run</code> tốt hơn, bởi ta có thể check null trước khi sử dụng nó.</p><h4 id="2-this-vs-it-argument">2. This vs. it argument</h4><p>Tiếp theo là <code class="language-plaintext highlighter-rouge">T.run</code> và <code class="language-plaintext highlighter-rouge">T.let</code>, cả 2 function khá giống nhau ngoại trừ cách mà chúng nhận tham số.</p><p>Hãy nhìn ví dụ bên dưới :</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="n">stringVariable</span><span class="o">?.</span><span class="na">run</span> <span class="o">{</span>
      <span class="n">println</span><span class="o">(</span><span class="s">"The length of this String is $length"</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// Similarly.</span>
<span class="n">stringVariable</span><span class="o">?.</span><span class="na">let</span> <span class="o">{</span>
      <span class="n">println</span><span class="o">(</span><span class="s">"The length of this String is ${it.length}"</span><span class="o">)</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Nếu để ý vào chi tiết của <code class="language-plaintext highlighter-rouge">T.run</code>, bạn sẽ thấy <code class="language-plaintext highlighter-rouge">T.run</code> chỉ được tạo ra dưới dạng extension function gọi là T.() . Do đó tất cả bên trong scope, T có thể được gọi như <code class="language-plaintext highlighter-rouge">this</code>. Trong lập trình, phần lớn <code class="language-plaintext highlighter-rouge">this</code> đều có thể bỏ qua. Vì vậy, ta có thể sử dụng <code class="language-plaintext highlighter-rouge">$length</code> thay vì <code class="language-plaintext highlighter-rouge">${this.length}</code>.</p><p>Với <code class="language-plaintext highlighter-rouge">T.let</code>, bạn sẽ thấy <code class="language-plaintext highlighter-rouge">T.let</code> gửi chính nó vào<code class="language-plaintext highlighter-rouge"> block: (T)</code>. và có thể được gọi trong function như <code class="language-plaintext highlighter-rouge">it</code>.</p><p>Từ đặc điểm của<code class="language-plaintext highlighter-rouge"> T.let</code> và <code class="language-plaintext highlighter-rouge">T.run</code>, có vẻ như <code class="language-plaintext highlighter-rouge">T.run</code> tốt hơn <code class="language-plaintext highlighter-rouge">T.let</code>, nhưng <code class="language-plaintext highlighter-rouge">T.let</code> có một số ưu điểm như sau :</p><ul><li><code class="language-plaintext highlighter-rouge">T.let</code> giúp phân biệt rõ ràng hơn biến thành viên và bên ngoài<li>Trong 1 số trường hợp this không thể bỏ qua, “it” ngắn hơn “this”<li>T.let cho phép đặt tên chuyển đổi, do đó bạn có thể đổi “it” sang một cái tên khác dễ hiểu hơn.<div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">stringVariable</span><span class="o">?.</span><span class="na">let</span> <span class="o">{</span>
  <span class="n">nonNullString</span> <span class="o">-&gt;</span>
  <span class="n">println</span><span class="o">(</span><span class="s">"The non null string is $nonNullString"</span><span class="o">)</span>
<span class="o">}</span>
</pre></table></code></div></div></ul><h4 id="3return-this-vs-other-type">3.Return this vs. other type</h4><p>Giờ hãy để ý đến <code class="language-plaintext highlighter-rouge">T.let</code> và <code class="language-plaintext highlighter-rouge">T.also</code>, cả 2 đều giống nhau nếu ta nhìn vào phần thân của chúng :</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="n">stringVariable</span><span class="o">?.</span><span class="na">let</span> <span class="o">{</span>
      <span class="n">println</span><span class="o">(</span><span class="s">"The length of this String is ${it.length}"</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// Exactly the same as below</span>
<span class="n">stringVariable</span><span class="o">?.</span><span class="na">also</span> <span class="o">{</span>
      <span class="n">println</span><span class="o">(</span><span class="s">"The length of this String is ${it.length}"</span><span class="o">)</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Tuy nhiên, sự khác biệt giữa chúng là đối tượng trả về. <code class="language-plaintext highlighter-rouge">T.let</code> cho phép trả về một kiểu giá trị khác trong khi <code class="language-plaintext highlighter-rouge">T.also</code> trả về chính nó T.</p><p>Cả 2 đều hữu ích đối với các hàm chuỗi (chaining function) khi mà <code class="language-plaintext highlighter-rouge">T.let</code> cho phép bạn triển khai các operation liên tục và <code class="language-plaintext highlighter-rouge">T.also</code> cho phép bạn biểu diễn trên cùng một variable. Dưới đây là một minh họa :</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre>
<span class="n">val</span> <span class="n">original</span> <span class="o">=</span> <span class="s">"abc"</span>
<span class="c1">// Evolve the value and send to the next chain</span>
<span class="n">original</span><span class="o">.</span><span class="na">let</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"The original String is $it"</span><span class="o">)</span> <span class="c1">// "abc"</span>
    <span class="n">it</span><span class="o">.</span><span class="na">reversed</span><span class="o">()</span> <span class="c1">// evolve it as parameter to send to next let</span>
<span class="o">}.</span><span class="na">let</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"The reverse String is $it"</span><span class="o">)</span> <span class="c1">// "cba"</span>
    <span class="n">it</span><span class="o">.</span><span class="na">length</span>  <span class="c1">// can be evolve to other type</span>
<span class="o">}.</span><span class="na">let</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"The length of the String is $it"</span><span class="o">)</span> <span class="c1">// 3</span>
<span class="o">}</span>
<span class="c1">// Wrong</span>
<span class="c1">// Same value is sent in the chain (printed answer is wrong)</span>
<span class="n">original</span><span class="o">.</span><span class="na">also</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"The original String is $it"</span><span class="o">)</span> <span class="c1">// "abc"</span>
    <span class="n">it</span><span class="o">.</span><span class="na">reversed</span><span class="o">()</span> <span class="c1">// even if we evolve it, it is useless</span>
<span class="o">}.</span><span class="na">also</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"The reverse String is ${it}"</span><span class="o">)</span> <span class="c1">// "abc"</span>
    <span class="n">it</span><span class="o">.</span><span class="na">length</span>  <span class="c1">// even if we evolve it, it is useless</span>
<span class="o">}.</span><span class="na">also</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"The length of the String is ${it}"</span><span class="o">)</span> <span class="c1">// "abc"</span>
<span class="o">}</span>
<span class="c1">// Corrected for also (i.e. manipulate as original string</span>
<span class="c1">// Same value is sent in the chain </span>
<span class="n">original</span><span class="o">.</span><span class="na">also</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"The original String is $it"</span><span class="o">)</span> <span class="c1">// "abc"</span>
<span class="o">}.</span><span class="na">also</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"The reverse String is ${it.reversed()}"</span><span class="o">)</span> <span class="c1">// "cba"</span>
<span class="o">}.</span><span class="na">also</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"The length of the String is ${it.length}"</span><span class="o">)</span> <span class="c1">// 3</span>
<span class="o">}</span>

</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">T.also</code> có vẻ không có tác dụng ở trên, vì ta có thể kết hợp chúng thành một khối chức năng duy nhất. Tuy nhiên, suy nghĩ kĩ một chút, chúng ta có thể thấy nó có một số điểm mạnh như:</p><ul><li>Tách rời rất rõ ràng trên cùng một đối tượng, tức là làm cho phần chức năng nhỏ hơn.<li>Có thể tự thao tác trước khi được sử dụng, tạo ra một hoạt động xây dựng chuỗi.</ul><p>Thử kết hợp <code class="language-plaintext highlighter-rouge">T.let</code> và <code class="language-plaintext highlighter-rouge">T.also</code> xem nào :</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c1">// Normal approach</span>
<span class="n">fun</span> <span class="nf">makeDir</span><span class="o">(</span><span class="nl">path:</span> <span class="nc">String</span><span class="o">):</span> <span class="nc">File</span>  <span class="o">{</span>
    <span class="n">val</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">File</span><span class="o">(</span><span class="n">path</span><span class="o">)</span>
    <span class="n">result</span><span class="o">.</span><span class="na">mkdirs</span><span class="o">()</span>
    <span class="k">return</span> <span class="n">result</span>
<span class="o">}</span>

<span class="c1">// Improved approach</span>
<span class="n">fun</span> <span class="nf">makeDir</span><span class="o">(</span><span class="nl">path:</span> <span class="nc">String</span><span class="o">)</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="na">let</span><span class="o">{</span> <span class="nc">File</span><span class="o">(</span><span class="n">it</span><span class="o">)</span> <span class="o">}.</span><span class="na">also</span><span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">mkdirs</span><span class="o">()</span> <span class="o">}</span>
</pre></table></code></div></div><h3 id="looking-at-all-attributes">Looking at all attributes</h3><p>Qua các tiêu chí trên, ta có thể thấy được khá đầy đủ về cách các function <code class="language-plaintext highlighter-rouge">run</code> <code class="language-plaintext highlighter-rouge">with</code> <code class="language-plaintext highlighter-rouge">let</code> <code class="language-plaintext highlighter-rouge">also</code> hoạt động. Vậy còn <code class="language-plaintext highlighter-rouge">T.apply</code> thì sao ?</p><ul><li><code class="language-plaintext highlighter-rouge">T.apply</code> là một extension function<li><code class="language-plaintext highlighter-rouge">T.apply</code> gửi <code class="language-plaintext highlighter-rouge">this</code> như một tham số<li><code class="language-plaintext highlighter-rouge">T.apply</code> trả về <code class="language-plaintext highlighter-rouge">this</code>.</ul><p>Dưới đây là ví dụ :</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// Normal approach</span>
<span class="n">fun</span> <span class="nf">createInstance</span><span class="o">(</span><span class="nl">args:</span> <span class="nc">Bundle</span><span class="o">)</span> <span class="o">:</span> <span class="nc">MyFragment</span> <span class="o">{</span>
    <span class="n">val</span> <span class="n">fragment</span> <span class="o">=</span> <span class="nc">MyFragment</span><span class="o">()</span>
    <span class="n">fragment</span><span class="o">.</span><span class="na">arguments</span> <span class="o">=</span> <span class="n">args</span>
    <span class="k">return</span> <span class="n">fragment</span>
<span class="o">}</span>
<span class="c1">// Improved approach</span>
<span class="n">fun</span> <span class="nf">createInstance</span><span class="o">(</span><span class="nl">args:</span> <span class="nc">Bundle</span><span class="o">)</span> 
              <span class="o">=</span> <span class="nc">MyFragment</span><span class="o">().</span><span class="na">apply</span> <span class="o">{</span> <span class="n">arguments</span> <span class="o">=</span> <span class="n">args</span> <span class="o">}</span>

</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">// Normal approach</span>
<span class="n">fun</span> <span class="nf">createIntent</span><span class="o">(</span><span class="nl">intentData:</span> <span class="nc">String</span><span class="o">,</span> <span class="nl">intentAction:</span> <span class="nc">String</span><span class="o">):</span> <span class="nc">Intent</span> <span class="o">{</span>
    <span class="n">val</span> <span class="n">intent</span> <span class="o">=</span> <span class="nc">Intent</span><span class="o">()</span>
    <span class="n">intent</span><span class="o">.</span><span class="na">action</span> <span class="o">=</span> <span class="n">intentAction</span>
    <span class="n">intent</span><span class="o">.</span><span class="na">data</span><span class="o">=</span><span class="nc">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">intentData</span><span class="o">)</span>
    <span class="k">return</span> <span class="n">intent</span>
<span class="o">}</span>
<span class="c1">// Improved approach, chaining</span>
<span class="n">fun</span> <span class="nf">createIntent</span><span class="o">(</span><span class="nl">intentData:</span> <span class="nc">String</span><span class="o">,</span> <span class="nl">intentAction:</span> <span class="nc">String</span><span class="o">)</span> <span class="o">=</span>
        <span class="nc">Intent</span><span class="o">().</span><span class="na">apply</span> <span class="o">{</span> <span class="n">action</span> <span class="o">=</span> <span class="n">intentAction</span> <span class="o">}</span>
                <span class="o">.</span><span class="na">apply</span> <span class="o">{</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">intentData</span><span class="o">)</span> <span class="o">}</span>
                
</pre></table></code></div></div><h3 id="function-selections">Function selections</h3><p>Dựa vào các đặc trưng và tính năng của từng loại mà bạn hãy quyết định sử dụng chúng một cách hợp lý nhé :D</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://images.viblo.asia/62508328-1287-48d0-b74f-2060a30dcbe3.png" alt="" /></p><h3 id="references">References</h3><ol><li><a href="https://medium.com/@elye.project/mastering-kotlin-standard-functions-run-with-let-also-and-apply-9cd334b0ef84">https://medium.com/@elye.project/mastering-kotlin-standard-functions-run-with-let-also-and-apply-9cd334b0ef84</a></ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/android/'>Android</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/android/" class="post-tag no-text-decoration" >android</a> <a href="/tags/performance/" class="post-tag no-text-decoration" >performance</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[Android] Kotlin standard functions: run-with-let-also-apply - Hades&url=https://hadesptit.github.io/posts/kotlin-starndard-function/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[Android] Kotlin standard functions: run-with-let-also-apply - Hades&u=https://hadesptit.github.io/posts/kotlin-starndard-function/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[Android] Kotlin standard functions: run-with-let-also-apply - Hades&url=https://hadesptit.github.io/posts/kotlin-starndard-function/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://hadesptit.github.io/posts/kotlin-starndard-function/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/flutter/">flutter</a> <a class="post-tag" href="/tags/dart/">dart</a> <a class="post-tag" href="/tags/rxjava/">rxjava</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/new/">new</a> <a class="post-tag" href="/tags/performance/">performance</a> <a class="post-tag" href="/tags/android-studio/">android studio</a> <a class="post-tag" href="/tags/as/">as</a> <a class="post-tag" href="/tags/cicd/">cicd</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/android-performance-rendering/"><div class="card-body"> <span class="timeago small" > Dec 23, 2018 <i class="unloaded">2018-12-23T14:15:03+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Android] Performance  -  Rendering</h3><div class="text-muted small"><p> Hiệu năng ứng dụng luôn là vấn đề với mọi lập trình viên mobile. Bởi lẽ, nếu bạn nhận ra ứng dụng của mình chậm hoặc tệ hơn là ai đó nói với bạn rằng ứng dụng của bạn chậm quá thì thật đáng buồn ph...</p></div></div></a></div><div class="card"> <a href="/posts/android-structure/"><div class="card-body"> <span class="timeago small" > Aug 12, 2016 <i class="unloaded">2016-08-12T14:15:03+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Android] Cách tổ chức thư mục cho 1 project Android</h3><div class="text-muted small"><p> Hi mọi người! Dạo gần đây mình có xây dựng 1 dự án android nhỏ. Dưới đây là một cách tổ chức thư mục mà mình cho là khá hợp lý. Hi vọng mọi người có thể tham khảo và góp ý. ├─ com.abc │ ├─ activ...</p></div></div></a></div><div class="card"> <a href="/posts/android-recycler-view/"><div class="card-body"> <span class="timeago small" > Jul 12, 2018 <i class="unloaded">2018-07-12T14:15:03+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Android] RecyclerView</h3><div class="text-muted small"><p> Giới thiệu RecycleView là một viewGroup mới được giới thiệu trong Android L (API 21). Là một viewGroup có chức năng tương tự như ListView nhưng linh hoạt hơn rất nhiều. ListView chỉ hỗ trợ bạn sc...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/android-performance-rendering/" class="btn btn-outline-primary" prompt="previous"><p>[Android] Performance  -  Rendering</p></a> <a href="/posts/kotlin-sealed-class/" class="btn btn-outline-primary" prompt="next"><p>[Android] Kotlin Sealed Class</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/HadesPTIT">Hades</a>.</p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/flutter/">flutter</a> <a class="post-tag" href="/tags/dart/">dart</a> <a class="post-tag" href="/tags/rxjava/">rxjava</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/new/">new</a> <a class="post-tag" href="/tags/performance/">performance</a> <a class="post-tag" href="/tags/android-studio/">android studio</a> <a class="post-tag" href="/tags/as/">as</a> <a class="post-tag" href="/tags/cicd/">cicd</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://HadesPTIT.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
