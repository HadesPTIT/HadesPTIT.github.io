<!doctype html><html lang="en-US" data-mode="dark"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="[Flutter] Key trong Flutter" /><meta property="og:locale" content="en_US" /><meta name="description" content="Giới thiệu" /><meta property="og:description" content="Giới thiệu" /><link rel="canonical" href="https://hadesptit.github.io/posts/key-trong-flutter/" /><meta property="og:url" content="https://hadesptit.github.io/posts/key-trong-flutter/" /><meta property="og:site_name" content="Hades" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-06T14:15:03+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[Flutter] Key trong Flutter" /><meta name="twitter:site" content="@hades_pt" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-06-06T14:15:03+00:00","datePublished":"2021-06-06T14:15:03+00:00","description":"Giới thiệu","headline":"[Flutter] Key trong Flutter","mainEntityOfPage":{"@type":"WebPage","@id":"https://hadesptit.github.io/posts/key-trong-flutter/"},"url":"https://hadesptit.github.io/posts/key-trong-flutter/"}</script><title>[Flutter] Key trong Flutter | Hades</title><link rel="icon" type="image/png" href="/assets/img/favicons/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/svg+xml" href="/assets/img/favicons/favicon.svg"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://avatars.githubusercontent.com/u/20601191?s=400" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Hades</a><p class="site-subtitle fst-italic mb-0">Chase excellence success will follow you</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <a href="https://github.com/HadesPTIT" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/hades_pt" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['Hphamptit','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>[Flutter] Key trong Flutter</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link" aria-label="Search"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>[Flutter] Key trong Flutter</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1622988903" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jun 6, 2021 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/HadesPTIT">Hades</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1368 words" > <em>7 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">[Flutter] Key trong Flutter</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">[Flutter] Key trong Flutter</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h2 id="giới-thiệu"><span class="me-2">Giới thiệu</span><a href="#giới-thiệu" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><code class="language-plaintext highlighter-rouge">Key</code> được nhìn thấy ở hầu hết các phương thức khởi tạo widget. Nhưng việc sử dụng chúng không được phổ biến lắm. Trong bài viết này, mình sẽ cùng tìm hiểu xem key là gì, có những loại nào, cách dùng của chúng ra sao và khi nào thì sử dụng Key nhé.</p><h2 id="key-là-gì-"><span class="me-2">Key là gì ?</span><a href="#key-là-gì-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Key là một đối tượng định danh, nó dùng để duy trì trạng thái của Widget khi các Widget di chuyển vị trí trong Widget Tree.</p><h2 id="có-những-loại-key-nào-"><span class="me-2">Có những loại Key nào ?</span><a href="#có-những-loại-key-nào-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><code class="language-plaintext highlighter-rouge">Key</code> có 2 subclass là <code class="language-plaintext highlighter-rouge">LocalKey</code> và <code class="language-plaintext highlighter-rouge">GlobalKey</code>.</p><p>Trong đó <code class="language-plaintext highlighter-rouge">LocalKey</code> có 3 loại là <code class="language-plaintext highlighter-rouge">ValueKey</code>, <code class="language-plaintext highlighter-rouge">ObjectKey</code>, <code class="language-plaintext highlighter-rouge">UniqueKey</code></p><ul><li><p><strong>ValueKey</strong></p><p>Giả sử bạn đang xây dựng ứng dụng ToDo App, mỗi ToDo item đều có 1 ID duy nhất để phân biệt giữa các item. Trong trường hợp này, bạn nên sử dụng ValueKey. Nó sẽ giúp cho việc thêm, xoá, sửa 1 ToDo bất kỳ nhanh hơn, đặc biệt là với xoá.</p><li><p><strong>ObjectKey</strong></p><p>Giả sử rằng mỗi widget con lưu một tập dữ liệu phức tạp, chẳng hạn như một ứng dụng lưu trữ sổ địa chỉ cho thông tin người dùng. Bất kỳ trường thông tin nào, chẳng hạn như tên hoặc ngày sinh, có thể giống với một người khác, nhưng mỗi một tập dữ liệu là duy nhất. Trong những trường hợp này <code class="language-plaintext highlighter-rouge">ObjectKey</code> là phù hợp nhất.</p><li><p><strong>UniqueKey</strong></p><p>Nếu có nhiều widget có cùng loại hoặc nếu bạn cần đảm bảo rằng widget con không giống với các widget khác, bạn có thể sử dụng <code class="language-plaintext highlighter-rouge">UniqueKey</code>. Chúng ta đã sử dụng nó trong ví dụ trên. <code class="language-plaintext highlighter-rouge">UniqueKey</code>. Một điều cần chú ý rằng hãy cân nhắc việc sử dụng UniqueKey khi có những action như di chuyển, sửa đổi item chứa nhiều logic hay animation nặng bởi mỗi khi có thay đổi, state sẽ bị reset đồng nghĩa với việc widget sẽ bị rebuild lại.</p><li><p><strong>GlobalKey</strong></p><p>Chúng cho phép các Widget thay đổi parent của chúng ở bất kỳ vị trí nào trong ứng dụng mà không bị mất state hoặc chúng có thể được sử dụng để truy cập dữ liệu để lấy thông tin của một Widget bất kỳ.</p><p>Trong trường hợp thứ hai, bạn có thể cần kiểm tra mật khẩu, tuy nhiên bạn không muốn chia sẻ status data với các widget khác nhau trong cây và bạn có thể sử dụng GlobalKey<FromState>, nó nắm giữ State của Form.</FromState></p><p>Về cơ bản, GlobalKey giống như một biến toàn cục vậy. Có những cách khác tốt hơn để hoàn thành công việc của GlobalKey, chẳng hạn như inherited widget, Redux, or block pattern.</p></ul><h2 id="khi-nào-nên-dùng-key-"><span class="me-2">Khi nào nên dùng Key ?</span><a href="#khi-nào-nên-dùng-key-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Lý thuyết xuông thì khó hiểu, giờ mình cùng đi vào 1 vài ví dụ nhé. Trong ví dụ dưới đây, mình sẽ cùng hoán đổi vị trí 2 Widget có 2 màu sắc khác nhau. Màu sắc của mỗi widget là Random nha.</p><h3 id="swap-2-statelesswidget-"><span class="me-2">Swap 2 StatelessWidget ???</span><a href="#swap-2-statelesswidget-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">Tile</span> <span class="kd">extends</span> <span class="n">StatelessWidget</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">Color</span> <span class="n">color</span> <span class="o">=</span> <span class="n">generateRandomColor</span><span class="p">();</span> <span class="c1">// mỗi object sẽ có 1 random Color không thể thay đổi</span>

  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// tạm hiểu Container như cái thùng có màu sắc, kích thước =&gt; khá giống viên gạch =))</span>
    <span class="k">return</span> <span class="n">Container</span><span class="p">(</span>
      <span class="nl">color:</span> <span class="n">color</span><span class="p">,</span>
      <span class="nl">width:</span> <span class="mi">100</span><span class="p">,</span>
      <span class="nl">height:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// hàm tạo ra một Color bất kỳ</span>
<span class="n">Color</span> <span class="nf">generateRandomColor</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// biến random sẽ giúp ta tạo ra 1 số ngẫu nhiên</span>
  <span class="kd">final</span> <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="n">Random</span><span class="p">();</span>
  
  <span class="c1">// Màu sắc được tạo nên từ RGB, là một số ngẫu nhiên từ 0 -&gt; 255 và opacity = 1</span>
  <span class="k">return</span> <span class="n">Color</span><span class="o">.</span><span class="na">fromRGBO</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">_MyHomePageState</span> <span class="kd">extends</span> <span class="n">State</span><span class="p">&lt;</span><span class="n">MyHomePage</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="n">listTile</span> <span class="o">=</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span><span class="n">Tile</span><span class="p">(),</span> <span class="n">Tile</span><span class="p">()];</span> <span class="c1">// tạo 1 list lưu trữ 2 Widget</span>

  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Scaffold</span><span class="p">(</span>
      <span class="nl">body:</span> <span class="n">Center</span><span class="p">(</span>
        <span class="nl">child:</span> <span class="n">Row</span><span class="p">(</span>
          <span class="nl">children:</span> <span class="n">listTile</span><span class="p">,</span> <span class="c1">// Row nhận một list Widget nên mình truyền listTile vào</span>
        <span class="p">),</span>
      <span class="p">),</span>
      <span class="nl">floatingActionButton:</span> <span class="n">FloatingActionButton</span><span class="p">(</span>
        <span class="nl">onPressed:</span> <span class="n">swapTwoTileWidget</span><span class="p">,</span> <span class="c1">// thực hiện hoán đổi vị trí 2 Widget trong listTile</span>
        <span class="nl">child:</span> <span class="n">Icon</span><span class="p">(</span><span class="n">Icons</span><span class="o">.</span><span class="na">swap_horiz</span><span class="p">),</span>
      <span class="p">),</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// hàm thực hiện hoán đổi 2 Widget trong listTile</span>
  <span class="kt">void</span> <span class="n">swapTwoTileWidget</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
      <span class="n">listTile</span><span class="o">.</span><span class="na">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">listTile</span><span class="o">.</span><span class="na">removeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Ok, sau khi click swap, thì vị trí của 2 Widget được thay đổi đúng như những gì ta mong muốn.</p><p>1 lưu ý được các nhà phát triển Flutter có đề cập đến Key:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Remember, if the entire widget subtree in your collection is stateless, keys aren't needed.
</pre></table></code></div></div><blockquote><p>Có thể hiểu rằng Key sẽ không cần thiết nếu như các widget subtree là các StatelessWidget</p></blockquote><h4 id="swap-2-statefulwidget-"><span class="me-2">Swap 2 StatefulWidget ???</span><a href="#swap-2-statefulwidget-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Ok, hãy quay lại class <code class="language-plaintext highlighter-rouge">Tile</code> và convert nó thành StatefulWidget thay vì StatelessWidget.</p><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">Tile</span> <span class="kd">extends</span> <span class="n">StatefulWidget</span> <span class="p">{</span>
  <span class="nd">@override</span>
  <span class="n">State</span><span class="p">&lt;</span><span class="n">Tile</span><span class="p">&gt;</span> <span class="n">createState</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">_TileState</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">_TileState</span> <span class="kd">extends</span> <span class="n">State</span><span class="p">&lt;</span><span class="n">Tile</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">Color</span> <span class="n">color</span> <span class="o">=</span> <span class="n">generateRandomColor</span><span class="p">();</span> 
  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// tạm hiểu Container như cái thùng có màu sắc, kích thước =&gt; khá giống viên gạch =))</span>
    <span class="k">return</span> <span class="n">Container</span><span class="p">(</span>
      <span class="nl">color:</span> <span class="n">color</span><span class="p">,</span>
      <span class="nl">width:</span> <span class="mi">100</span><span class="p">,</span>
      <span class="nl">height:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// hàm tạo ra một Color bất kỳ</span>
<span class="n">Color</span> <span class="nf">generateRandomColor</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// biến random sẽ giúp ta tạo ra 1 số ngẫu nhiên</span>
  <span class="kd">final</span> <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="n">Random</span><span class="p">();</span>
  
  <span class="c1">// Màu sắc được tạo nên từ RGB, là một số ngẫu nhiên từ 0 -&gt; 255 và opacity = 1</span>
  <span class="k">return</span> <span class="n">Color</span><span class="o">.</span><span class="na">fromRGBO</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Giờ hãy click button swap xem…click mãi mà không thấy có gì xảy ra phải không :D nào thì giờ fixbug thôi.</p><p>Trong constructor của Tile, hãy truyền thêm tham số Key vào như sau:</p><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Tile</span><span class="p">({</span><span class="n">Key</span> <span class="n">key</span><span class="p">})</span> <span class="o">:</span> <span class="k">super</span><span class="p">(</span><span class="nl">key:</span> <span class="n">key</span><span class="p">);</span>
</pre></table></code></div></div><p>Giờ hãy tạo ra 1 UniqueKey rồi gắn vào nhé.</p><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="n">listTile</span> <span class="o">=</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span><span class="n">Tile</span><span class="p">(</span><span class="nl">key:</span> <span class="n">UniqueKey</span><span class="p">()),</span> <span class="n">Tile</span><span class="p">(</span><span class="nl">key:</span> <span class="n">UniqueKey</span><span class="p">())];</span> <span class="c1">// UniqueKey() tạo ra 1 key</span>
</pre></table></code></div></div><p>Ok, giờ thì swap lại hoạt động trở lại rồi đó :D</p><blockquote><p>Nếu Widget được khai báo Key thì Element không chỉ so sánh Widget Type mà còn so sánh cả Key của widget cũ mà nó đang giữ tham chiếu và widget mới</p></blockquote><p>Hãy cùng làm một ví dụ tiếp nối ví dụ trên nhé. Vẫn sử dụng Tile là statefulWidget, giờ hãy wrap Tile vào 1 thằng <code class="language-plaintext highlighter-rouge">Padding</code> xem sao</p><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="n">listTile</span> <span class="o">=</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
    <span class="n">Padding</span><span class="p">(</span>
      <span class="nl">padding:</span> <span class="kd">const</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">all</span><span class="p">(</span><span class="mf">8.0</span><span class="p">),</span>
      <span class="nl">child:</span> <span class="n">Tile</span><span class="p">(</span><span class="nl">key:</span> <span class="n">UniqueKey</span><span class="p">()),</span>
    <span class="p">),</span>
    <span class="n">Padding</span><span class="p">(</span>
      <span class="nl">padding:</span> <span class="kd">const</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">all</span><span class="p">(</span><span class="mf">8.0</span><span class="p">),</span>
      <span class="nl">child:</span> <span class="n">Tile</span><span class="p">(</span><span class="nl">key:</span> <span class="n">UniqueKey</span><span class="p">()),</span>
    <span class="p">)</span>
<span class="p">];</span>
</pre></table></code></div></div><p>=&gt; Giờ rebuild lại app và thử click button Swap, một điều kì diệu xảy ra là mỗi lần click thì màu của 2 ô vuông lại thay đổi, ảo ma canada =))</p><p>Màu của widget thay đổi liên tục đồng nghĩa với việc State của Widget đó bị khởi tạo lại, <code class="language-plaintext highlighter-rouge">createState()</code> được gọi và 1 màu mới được sinh ra.</p><p>Lý do bởi khi Local Key, thì quá trình matching up widget to elements chỉ diễn ra trong cùng một level cụ thể trên hệ thống tree, ở đây là 2 Padding view. Element bị deactive mà không tìm được widget để connect thì nó sẽ bị dispose.</p><p>=&gt; LocalKey chỉ nên được đặt ở các Widget là top level, level cao nhất trong list children của một Row hoặc một Column. Trong 1 row, các widget con đều có cùng một level, Flutter sẽ tìm được.</p><p>Giờ cách fix đơn giản hơn rồi phải không, move key ở thằng Tile chuyển lên thằng Padding:</p><div class="language-dart highlighter-rouge"><div class="code-header"> <span data-label-text="Dart"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="n">listTile</span> <span class="o">=</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
    <span class="n">Padding</span><span class="p">(</span>
      <span class="nl">key:</span> <span class="n">UniqueKey</span><span class="p">(),</span> <span class="c1">// đưa key từ Tile lên Padding</span>
      <span class="nl">padding:</span> <span class="kd">const</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">all</span><span class="p">(</span><span class="mf">8.0</span><span class="p">),</span>
      <span class="nl">child:</span> <span class="n">Tile</span><span class="p">(),</span>
    <span class="p">),</span>
    <span class="n">Padding</span><span class="p">(</span>
      <span class="nl">key:</span> <span class="n">UniqueKey</span><span class="p">(),</span> <span class="c1">// đưa key từ Tile lên Padding</span>
      <span class="nl">padding:</span> <span class="kd">const</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">all</span><span class="p">(</span><span class="mf">8.0</span><span class="p">),</span>
      <span class="nl">child:</span> <span class="n">Tile</span><span class="p">(),</span>
    <span class="p">)</span>
  <span class="p">];</span>
</pre></table></code></div></div><h3 id="tổng-kết"><span class="me-2">Tổng kết</span><a href="#tổng-kết" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Hi vọng qua bài viết này bạn có thể hiểu được cơ bản và cách dùng của Key. Happy coding :D</p><ul><li><p><a href="https://medium.com/flutter/keys-what-are-they-good-for-13cb51742e7d">https://medium.com/flutter/keys-what-are-they-good-for-13cb51742e7d</a></p><li><p><a href="https://app.slack.com/client/TBFDUP13L/C01CUJW4H18">https://app.slack.com/client/TBFDUP13L/C01CUJW4H18</a></p></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/flutter/">Flutter</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/dart/" class="post-tag no-text-decoration" >dart</a> <a href="/tags/flutter/" class="post-tag no-text-decoration" >flutter</a> <a href="/tags/key/" class="post-tag no-text-decoration" >key</a> <a href="/tags/localkey/" class="post-tag no-text-decoration" >localkey</a> <a href="/tags/uniquekey/" class="post-tag no-text-decoration" >uniqueKey</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[Flutter]%20Key%20trong%20Flutter%20-%20Hades&url=https%3A%2F%2Fhadesptit.github.io%2Fposts%2Fkey-trong-flutter%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[Flutter]%20Key%20trong%20Flutter%20-%20Hades&u=https%3A%2F%2Fhadesptit.github.io%2Fposts%2Fkey-trong-flutter%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[Flutter]%20Key%20trong%20Flutter%20-%20Hades&url=https%3A%2F%2Fhadesptit.github.io%2Fposts%2Fkey-trong-flutter%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fhadesptit.github.io%2Fposts%2Fkey-trong-flutter%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recent Update</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/flutter-338/">[Flutter] Flutter 3.38 & Dart 3.10 có gì mới ?</a><li class="text-truncate lh-lg"> <a href="/posts/flutter-33/">[Flutter] Flutter 3.3 có gì mới ?</a><li class="text-truncate lh-lg"> <a href="/posts/what-news-in-flutter3/">[Flutter] Flutter 3.0 có gì mới ?</a><li class="text-truncate lh-lg"> <a href="/posts/flutter-2.8/">[Flutter] Flutter 2.8 có gì mới ?</a><li class="text-truncate lh-lg"> <a href="/posts/shrinkwrap-vs-slivers/">[Flutter] ShrinkWrap vs Slivers | Decoding Flutter</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/android/">android</a> <a class="post-tag btn btn-outline-primary" href="/tags/flutter/">flutter</a> <a class="post-tag btn btn-outline-primary" href="/tags/dart/">dart</a> <a class="post-tag btn btn-outline-primary" href="/tags/rxjava/">rxjava</a> <a class="post-tag btn btn-outline-primary" href="/tags/kotlin/">kotlin</a> <a class="post-tag btn btn-outline-primary" href="/tags/new/">new</a> <a class="post-tag btn btn-outline-primary" href="/tags/performance/">performance</a> <a class="post-tag btn btn-outline-primary" href="/tags/android-studio/">android studio</a> <a class="post-tag btn btn-outline-primary" href="/tags/as/">as</a> <a class="post-tag btn btn-outline-primary" href="/tags/cicd/">cicd</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/what-news-in-flutter3/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1654092903" data-df="ll" > Jun 1, 2022 </time><h4 class="pt-0 my-2">[Flutter] Flutter 3.0 có gì mới ?</h4><div class="text-muted"><p>Giới thiệu 11/05/2022, Google I/O chính thức phát hành phiên bản Flutter 3 với rất nhiều cải tiến đáng kể. Đặc biệt dành cho các thiết bị sử dụng window. Trong bài viết này mình sẽ cùng tìm hiểu x...</p></div></div></a></article><article class="col"> <a href="/posts/shrinkwrap-vs-slivers/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1637417703" data-df="ll" > Nov 20, 2021 </time><h4 class="pt-0 my-2">[Flutter] ShrinkWrap vs Slivers | Decoding Flutter</h4><div class="text-muted"><p>Introduction Một trong những widget cơ bản mà các developer sử dụng thường xuyên đó là ListView. ListView rất dễ dùng, nhưng để tối ưu nó thì không hẳn ai cũng biết. Trong bài viết này, mình sẽ c...</p></div></div></a></article><article class="col"> <a href="/posts/flutter-2.0.5-news/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1631974503" data-df="ll" > Sep 18, 2021 </time><h4 class="pt-0 my-2">[Flutter] Flutter 2.5 có gì mới</h4><div class="text-muted"><p>Giới thiệu Google, gã khổng lồ tìm kiếm mới đây vừa tung ra phiên bản release 2.5 với 4600 closed issues và 3932 merged PRs. Đi kèm với nó, Dart 2.14 cũng được release cùng thời điểm. Trong bài vi...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/how-nulll-safety-help-me/" class="btn btn-outline-primary" aria-label="Older" ><p>[Flutter] Dart’s null safety đã tối ưu ứng dụng của tôi như nào ?</p></a> <a href="/posts/flutter-2.0.5-news/" class="btn btn-outline-primary" aria-label="Newer" ><p>[Flutter] Flutter 2.5 có gì mới</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://github.com/HadesPTIT">Hades</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.4.1" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/android/">android</a> <a class="post-tag btn btn-outline-primary" href="/tags/flutter/">flutter</a> <a class="post-tag btn btn-outline-primary" href="/tags/dart/">dart</a> <a class="post-tag btn btn-outline-primary" href="/tags/rxjava/">rxjava</a> <a class="post-tag btn btn-outline-primary" href="/tags/kotlin/">kotlin</a> <a class="post-tag btn btn-outline-primary" href="/tags/new/">new</a> <a class="post-tag btn btn-outline-primary" href="/tags/performance/">performance</a> <a class="post-tag btn btn-outline-primary" href="/tags/android-studio/">android studio</a> <a class="post-tag btn btn-outline-primary" href="/tags/as/">as</a> <a class="post-tag btn btn-outline-primary" href="/tags/cicd/">cicd</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{content}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
