<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="[Flutter] Key trong Flutter" /><meta property="og:locale" content="en_US" /><meta name="description" content="Giới thiệu" /><meta property="og:description" content="Giới thiệu" /><link rel="canonical" href="https://hadesptit.github.io/posts/key-trong-flutter/" /><meta property="og:url" content="https://hadesptit.github.io/posts/key-trong-flutter/" /><meta property="og:site_name" content="Hades" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-06T14:15:03+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[Flutter] Key trong Flutter" /><meta name="twitter:site" content="@hades_pt" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-06-06T14:15:03+00:00","datePublished":"2021-06-06T14:15:03+00:00","description":"Giới thiệu","headline":"[Flutter] Key trong Flutter","mainEntityOfPage":{"@type":"WebPage","@id":"https://hadesptit.github.io/posts/key-trong-flutter/"},"url":"https://hadesptit.github.io/posts/key-trong-flutter/"}</script><title>[Flutter] Key trong Flutter | Hades</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/20601191?s=400" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Hades</a></div><div class="site-subtitle font-italic">Chase excellence success will follow you</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/HadesPTIT" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/hades_pt" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['Hphamptit','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>[Flutter] Key trong Flutter</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[Flutter] Key trong Flutter</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Hades </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Jun 6, 2021, 2:15 PM +0000" prep="on" > Jun 6, 2021 <i class="unloaded">2021-06-06T14:15:03+00:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1368 words">7 min</span></div></div><div class="post-content"><h2 id="giới-thiệu">Giới thiệu</h2><p><code class="language-plaintext highlighter-rouge">Key</code> được nhìn thấy ở hầu hết các phương thức khởi tạo widget. Nhưng việc sử dụng chúng không được phổ biến lắm. Trong bài viết này, mình sẽ cùng tìm hiểu xem key là gì, có những loại nào, cách dùng của chúng ra sao và khi nào thì sử dụng Key nhé.</p><h2 id="key-là-gì-">Key là gì ?</h2><p>Key là một đối tượng định danh, nó dùng để duy trì trạng thái của Widget khi các Widget di chuyển vị trí trong Widget Tree.</p><h2 id="có-những-loại-key-nào-">Có những loại Key nào ?</h2><p><code class="language-plaintext highlighter-rouge">Key</code> có 2 subclass là <code class="language-plaintext highlighter-rouge">LocalKey</code> và <code class="language-plaintext highlighter-rouge">GlobalKey</code>.</p><p>Trong đó <code class="language-plaintext highlighter-rouge">LocalKey</code> có 3 loại là <code class="language-plaintext highlighter-rouge">ValueKey</code>, <code class="language-plaintext highlighter-rouge">ObjectKey</code>, <code class="language-plaintext highlighter-rouge">UniqueKey</code></p><ul><li><p><strong>ValueKey</strong></p><p>Giả sử bạn đang xây dựng ứng dụng ToDo App, mỗi ToDo item đều có 1 ID duy nhất để phân biệt giữa các item. Trong trường hợp này, bạn nên sử dụng ValueKey. Nó sẽ giúp cho việc thêm, xoá, sửa 1 ToDo bất kỳ nhanh hơn, đặc biệt là với xoá.</p><li><p><strong>ObjectKey</strong></p><p>Giả sử rằng mỗi widget con lưu một tập dữ liệu phức tạp, chẳng hạn như một ứng dụng lưu trữ sổ địa chỉ cho thông tin người dùng. Bất kỳ trường thông tin nào, chẳng hạn như tên hoặc ngày sinh, có thể giống với một người khác, nhưng mỗi một tập dữ liệu là duy nhất. Trong những trường hợp này <code class="language-plaintext highlighter-rouge">ObjectKey</code> là phù hợp nhất.</p><li><p><strong>UniqueKey</strong></p><p>Nếu có nhiều widget có cùng loại hoặc nếu bạn cần đảm bảo rằng widget con không giống với các widget khác, bạn có thể sử dụng <code class="language-plaintext highlighter-rouge">UniqueKey</code>. Chúng ta đã sử dụng nó trong ví dụ trên. <code class="language-plaintext highlighter-rouge">UniqueKey</code>. Một điều cần chú ý rằng hãy cân nhắc việc sử dụng UniqueKey khi có những action như di chuyển, sửa đổi item chứa nhiều logic hay animation nặng bởi mỗi khi có thay đổi, state sẽ bị reset đồng nghĩa với việc widget sẽ bị rebuild lại.</p><li><p><strong>GlobalKey</strong></p><p>Chúng cho phép các Widget thay đổi parent của chúng ở bất kỳ vị trí nào trong ứng dụng mà không bị mất state hoặc chúng có thể được sử dụng để truy cập dữ liệu để lấy thông tin của một Widget bất kỳ.</p><p>Trong trường hợp thứ hai, bạn có thể cần kiểm tra mật khẩu, tuy nhiên bạn không muốn chia sẻ status data với các widget khác nhau trong cây và bạn có thể sử dụng GlobalKey<FromState>, nó nắm giữ State của Form.</FromState></p><p>Về cơ bản, GlobalKey giống như một biến toàn cục vậy. Có những cách khác tốt hơn để hoàn thành công việc của GlobalKey, chẳng hạn như inherited widget, Redux, or block pattern.</p></ul><h2 id="khi-nào-nên-dùng-key-">Khi nào nên dùng Key ?</h2><p>Lý thuyết xuông thì khó hiểu, giờ mình cùng đi vào 1 vài ví dụ nhé. Trong ví dụ dưới đây, mình sẽ cùng hoán đổi vị trí 2 Widget có 2 màu sắc khác nhau. Màu sắc của mỗi widget là Random nha.</p><h3 id="swap-2-statelesswidget-">Swap 2 StatelessWidget ???</h3><div class="language-dart highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">Tile</span> <span class="kd">extends</span> <span class="n">StatelessWidget</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">Color</span> <span class="n">color</span> <span class="o">=</span> <span class="n">generateRandomColor</span><span class="p">();</span> <span class="c1">// mỗi object sẽ có 1 random Color không thể thay đổi</span>

  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// tạm hiểu Container như cái thùng có màu sắc, kích thước =&gt; khá giống viên gạch =))</span>
    <span class="k">return</span> <span class="n">Container</span><span class="p">(</span>
      <span class="nl">color:</span> <span class="n">color</span><span class="p">,</span>
      <span class="nl">width:</span> <span class="mi">100</span><span class="p">,</span>
      <span class="nl">height:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// hàm tạo ra một Color bất kỳ</span>
<span class="n">Color</span> <span class="nf">generateRandomColor</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// biến random sẽ giúp ta tạo ra 1 số ngẫu nhiên</span>
  <span class="kd">final</span> <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="n">Random</span><span class="p">();</span>
  
  <span class="c1">// Màu sắc được tạo nên từ RGB, là một số ngẫu nhiên từ 0 -&gt; 255 và opacity = 1</span>
  <span class="k">return</span> <span class="n">Color</span><span class="o">.</span><span class="na">fromRGBO</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-dart highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">_MyHomePageState</span> <span class="kd">extends</span> <span class="n">State</span><span class="p">&lt;</span><span class="n">MyHomePage</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="n">listTile</span> <span class="o">=</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span><span class="n">Tile</span><span class="p">(),</span> <span class="n">Tile</span><span class="p">()];</span> <span class="c1">// tạo 1 list lưu trữ 2 Widget</span>

  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Scaffold</span><span class="p">(</span>
      <span class="nl">body:</span> <span class="n">Center</span><span class="p">(</span>
        <span class="nl">child:</span> <span class="n">Row</span><span class="p">(</span>
          <span class="nl">children:</span> <span class="n">listTile</span><span class="p">,</span> <span class="c1">// Row nhận một list Widget nên mình truyền listTile vào</span>
        <span class="p">),</span>
      <span class="p">),</span>
      <span class="nl">floatingActionButton:</span> <span class="n">FloatingActionButton</span><span class="p">(</span>
        <span class="nl">onPressed:</span> <span class="n">swapTwoTileWidget</span><span class="p">,</span> <span class="c1">// thực hiện hoán đổi vị trí 2 Widget trong listTile</span>
        <span class="nl">child:</span> <span class="n">Icon</span><span class="p">(</span><span class="n">Icons</span><span class="o">.</span><span class="na">swap_horiz</span><span class="p">),</span>
      <span class="p">),</span>
    <span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// hàm thực hiện hoán đổi 2 Widget trong listTile</span>
  <span class="kt">void</span> <span class="n">swapTwoTileWidget</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">setState</span><span class="p">(()</span> <span class="p">{</span>
      <span class="n">listTile</span><span class="o">.</span><span class="na">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">listTile</span><span class="o">.</span><span class="na">removeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Ok, sau khi click swap, thì vị trí của 2 Widget được thay đổi đúng như những gì ta mong muốn.</p><p>1 lưu ý được các nhà phát triển Flutter có đề cập đến Key:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Remember, if the entire widget subtree in your collection is stateless, keys aren't needed.
</pre></table></code></div></div><blockquote><p>Có thể hiểu rằng Key sẽ không cần thiết nếu như các widget subtree là các StatelessWidget</p></blockquote><h4 id="swap-2-statefulwidget-">Swap 2 StatefulWidget ???</h4><p>Ok, hãy quay lại class <code class="language-plaintext highlighter-rouge">Tile</code> và convert nó thành StatefulWidget thay vì StatelessWidget.</p><div class="language-dart highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">Tile</span> <span class="kd">extends</span> <span class="n">StatefulWidget</span> <span class="p">{</span>
  <span class="nd">@override</span>
  <span class="n">State</span><span class="p">&lt;</span><span class="n">Tile</span><span class="p">&gt;</span> <span class="n">createState</span><span class="p">()</span> <span class="o">=</span><span class="p">&gt;</span> <span class="n">_TileState</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">_TileState</span> <span class="kd">extends</span> <span class="n">State</span><span class="p">&lt;</span><span class="n">Tile</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="kd">final</span> <span class="n">Color</span> <span class="n">color</span> <span class="o">=</span> <span class="n">generateRandomColor</span><span class="p">();</span> 
  <span class="nd">@override</span>
  <span class="n">Widget</span> <span class="n">build</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// tạm hiểu Container như cái thùng có màu sắc, kích thước =&gt; khá giống viên gạch =))</span>
    <span class="k">return</span> <span class="n">Container</span><span class="p">(</span>
      <span class="nl">color:</span> <span class="n">color</span><span class="p">,</span>
      <span class="nl">width:</span> <span class="mi">100</span><span class="p">,</span>
      <span class="nl">height:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// hàm tạo ra một Color bất kỳ</span>
<span class="n">Color</span> <span class="nf">generateRandomColor</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// biến random sẽ giúp ta tạo ra 1 số ngẫu nhiên</span>
  <span class="kd">final</span> <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="n">Random</span><span class="p">();</span>
  
  <span class="c1">// Màu sắc được tạo nên từ RGB, là một số ngẫu nhiên từ 0 -&gt; 255 và opacity = 1</span>
  <span class="k">return</span> <span class="n">Color</span><span class="o">.</span><span class="na">fromRGBO</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Giờ hãy click button swap xem…click mãi mà không thấy có gì xảy ra phải không :D nào thì giờ fixbug thôi.</p><p>Trong constructor của Tile, hãy truyền thêm tham số Key vào như sau:</p><div class="language-dart highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">Tile</span><span class="p">({</span><span class="n">Key</span> <span class="n">key</span><span class="p">})</span> <span class="o">:</span> <span class="k">super</span><span class="p">(</span><span class="nl">key:</span> <span class="n">key</span><span class="p">);</span>
</pre></table></code></div></div><p>Giờ hãy tạo ra 1 UniqueKey rồi gắn vào nhé.</p><div class="language-dart highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="n">listTile</span> <span class="o">=</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span><span class="n">Tile</span><span class="p">(</span><span class="nl">key:</span> <span class="n">UniqueKey</span><span class="p">()),</span> <span class="n">Tile</span><span class="p">(</span><span class="nl">key:</span> <span class="n">UniqueKey</span><span class="p">())];</span> <span class="c1">// UniqueKey() tạo ra 1 key</span>
</pre></table></code></div></div><p>Ok, giờ thì swap lại hoạt động trở lại rồi đó :D</p><blockquote><p>Nếu Widget được khai báo Key thì Element không chỉ so sánh Widget Type mà còn so sánh cả Key của widget cũ mà nó đang giữ tham chiếu và widget mới</p></blockquote><p>Hãy cùng làm một ví dụ tiếp nối ví dụ trên nhé. Vẫn sử dụng Tile là statefulWidget, giờ hãy wrap Tile vào 1 thằng <code class="language-plaintext highlighter-rouge">Padding</code> xem sao</p><div class="language-dart highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="n">listTile</span> <span class="o">=</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
    <span class="n">Padding</span><span class="p">(</span>
      <span class="nl">padding:</span> <span class="kd">const</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">all</span><span class="p">(</span><span class="mf">8.0</span><span class="p">),</span>
      <span class="nl">child:</span> <span class="n">Tile</span><span class="p">(</span><span class="nl">key:</span> <span class="n">UniqueKey</span><span class="p">()),</span>
    <span class="p">),</span>
    <span class="n">Padding</span><span class="p">(</span>
      <span class="nl">padding:</span> <span class="kd">const</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">all</span><span class="p">(</span><span class="mf">8.0</span><span class="p">),</span>
      <span class="nl">child:</span> <span class="n">Tile</span><span class="p">(</span><span class="nl">key:</span> <span class="n">UniqueKey</span><span class="p">()),</span>
    <span class="p">)</span>
<span class="p">];</span>
</pre></table></code></div></div><p>=&gt; Giờ rebuild lại app và thử click button Swap, một điều kì diệu xảy ra là mỗi lần click thì màu của 2 ô vuông lại thay đổi, ảo ma canada =))</p><p>Màu của widget thay đổi liên tục đồng nghĩa với việc State của Widget đó bị khởi tạo lại, <code class="language-plaintext highlighter-rouge">createState()</code> được gọi và 1 màu mới được sinh ra.</p><p>Lý do bởi khi Local Key, thì quá trình matching up widget to elements chỉ diễn ra trong cùng một level cụ thể trên hệ thống tree, ở đây là 2 Padding view. Element bị deactive mà không tìm được widget để connect thì nó sẽ bị dispose.</p><p>=&gt; LocalKey chỉ nên được đặt ở các Widget là top level, level cao nhất trong list children của một Row hoặc một Column. Trong 1 row, các widget con đều có cùng một level, Flutter sẽ tìm được.</p><p>Giờ cách fix đơn giản hơn rồi phải không, move key ở thằng Tile chuyển lên thằng Padding:</p><div class="language-dart highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="n">listTile</span> <span class="o">=</span> <span class="p">&lt;</span><span class="n">Widget</span><span class="p">&gt;[</span>
    <span class="n">Padding</span><span class="p">(</span>
      <span class="nl">key:</span> <span class="n">UniqueKey</span><span class="p">(),</span> <span class="c1">// đưa key từ Tile lên Padding</span>
      <span class="nl">padding:</span> <span class="kd">const</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">all</span><span class="p">(</span><span class="mf">8.0</span><span class="p">),</span>
      <span class="nl">child:</span> <span class="n">Tile</span><span class="p">(),</span>
    <span class="p">),</span>
    <span class="n">Padding</span><span class="p">(</span>
      <span class="nl">key:</span> <span class="n">UniqueKey</span><span class="p">(),</span> <span class="c1">// đưa key từ Tile lên Padding</span>
      <span class="nl">padding:</span> <span class="kd">const</span> <span class="n">EdgeInsets</span><span class="o">.</span><span class="na">all</span><span class="p">(</span><span class="mf">8.0</span><span class="p">),</span>
      <span class="nl">child:</span> <span class="n">Tile</span><span class="p">(),</span>
    <span class="p">)</span>
  <span class="p">];</span>
</pre></table></code></div></div><h3 id="tổng-kết">Tổng kết</h3><p>Hi vọng qua bài viết này bạn có thể hiểu được cơ bản và cách dùng của Key. Happy coding :D</p><ul><li><p><a href="https://medium.com/flutter/keys-what-are-they-good-for-13cb51742e7d">https://medium.com/flutter/keys-what-are-they-good-for-13cb51742e7d</a></p><li><p><a href="https://app.slack.com/client/TBFDUP13L/C01CUJW4H18">https://app.slack.com/client/TBFDUP13L/C01CUJW4H18</a></p></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/flutter/'>Flutter</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/dart/" class="post-tag no-text-decoration" >dart</a> <a href="/tags/flutter/" class="post-tag no-text-decoration" >flutter</a> <a href="/tags/key/" class="post-tag no-text-decoration" >key</a> <a href="/tags/localkey/" class="post-tag no-text-decoration" >localkey</a> <a href="/tags/uniquekey/" class="post-tag no-text-decoration" >uniqueKey</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=[Flutter] Key trong Flutter - Hades&url=https://hadesptit.github.io/posts/key-trong-flutter/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=[Flutter] Key trong Flutter - Hades&u=https://hadesptit.github.io/posts/key-trong-flutter/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=[Flutter] Key trong Flutter - Hades&url=https://hadesptit.github.io/posts/key-trong-flutter/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://hadesptit.github.io/posts/key-trong-flutter/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/flutter/">flutter</a> <a class="post-tag" href="/tags/dart/">dart</a> <a class="post-tag" href="/tags/rxjava/">rxjava</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/new/">new</a> <a class="post-tag" href="/tags/performance/">performance</a> <a class="post-tag" href="/tags/android-studio/">android studio</a> <a class="post-tag" href="/tags/as/">as</a> <a class="post-tag" href="/tags/cicd/">cicd</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/what-news-in-flutter3/"><div class="card-body"> <span class="timeago small" > Jun 1 <i class="unloaded">2022-06-01T14:15:03+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Flutter] Flutter 3.0 có gì mới ?</h3><div class="text-muted small"><p> Giới thiệu 11/05/2022, Google I/O chính thức phát hành phiên bản Flutter 3 với rất nhiều cải tiến đáng kể. Đặc biệt dành cho các thiết bị sử dụng window. Trong bài viết này mình sẽ cùng tìm hiểu x...</p></div></div></a></div><div class="card"> <a href="/posts/stateful-lifecycle/"><div class="card-body"> <span class="timeago small" > Oct 1, 2020 <i class="unloaded">2020-10-01T14:15:03+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Flutter] StatefulWidget Lifecycle</h3><div class="text-muted small"><p> Hi mọi người ! Trong bài viết này mình sẽ cùng tìm hiểu về vòng đời của 1 StatefulWidget nhé. Introduction Khi Flutter build một StatefulWidget, nó sẽ tạo ra một State object. Object này là nơi ...</p></div></div></a></div><div class="card"> <a href="/posts/flutter-effective-dart/"><div class="card-body"> <span class="timeago small" > Dec 24, 2020 <i class="unloaded">2020-12-24T14:15:03+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Flutter] Effective Dart (Part I)</h3><div class="text-muted small"><p> Bài viết giúp bạn làm thế nào để xây dựng mã code clean clear hơn. Chi tiết ở đây Để áp dụng vào dự án nhanh và dễ dàng hơn, dart analyzer cung cấp lint - một bộ quy tắc cần tuân theo khi viết cod...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/how-nulll-safety-help-me/" class="btn btn-outline-primary" prompt="previous"><p>[Flutter] Dart’s null safety đã tối ưu ứng dụng của tôi như nào ?</p></a> <a href="/posts/flutter-2.0.5-news/" class="btn btn-outline-primary" prompt="next"><p>[Flutter] Flutter 2.5 có gì mới</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/HadesPTIT">Hades</a>.</p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/flutter/">flutter</a> <a class="post-tag" href="/tags/dart/">dart</a> <a class="post-tag" href="/tags/rxjava/">rxjava</a> <a class="post-tag" href="/tags/kotlin/">kotlin</a> <a class="post-tag" href="/tags/new/">new</a> <a class="post-tag" href="/tags/performance/">performance</a> <a class="post-tag" href="/tags/android-studio/">android studio</a> <a class="post-tag" href="/tags/as/">as</a> <a class="post-tag" href="/tags/cicd/">cicd</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://HadesPTIT.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
